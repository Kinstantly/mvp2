.search_results
	%h1= search_results_title @search, @search_area_tag_id
	- if @search.results.present?
		.search_results_options
			= form_tag search_providers_path, method: :get, id: 'nearest_to_city_postal_code_form' do
				= hidden_field_tag :query, @search_query
				= hidden_field_tag :search_area_tag_id, @search_area_tag_id
				= t 'views.search_results.nearest_to_city_postal_code'
				- city_prompt = 'city in California'
				= text_field_tag :city, @search_city, size: 12, id: 'search_city', placeholder: city_prompt, title: city_prompt
				= hidden_field_tag :region, DEFAULT_REGION
				= t 'views.or'
				- postal_code_prompt = 'zip code'
				= text_field_tag :postal_code, @search_postal_code, size: 10, id: 'search_postal_code', placeholder: postal_code_prompt, title: postal_code_prompt
				= submit_tag 'Show', disable_with: 'Show...', id: 'order_by_distance_button'
			#get_location_button_area{style: 'display: none'}
				= form_tag '#' do
					= t 'views.search_results.nearest_to_you'
					= submit_tag 'Nearest', id: 'get_location_button'
	.search_results_list
		- @search.results.each_with_index do |profile, i|
			.expert_result{id: "expert_result_#{i}"}
				%table
					%tr
						%td.left
							.name= search_result_name_headline profile
							.specialties= search_result_specialties profile
							.location= search_result_location profile
							.summary.text_area= preserve_profile_text profile.summary
						%td.right
							- if profile.ratings.size > 0
								= render partial: 'profiles/rating_score', locals: {profile: profile}
							.availability.text_area.right= preserve_profile_text "Availability:\n#{profile.availability}" if profile.availability.present?
							.accepting_new_clients.right= profile_display_accepting_new_clients profile
							.consultations.right= search_result_consultations profile

:coffeescript
	window.onload = ->
		window.rating_score_reset()
	if Modernizr.geolocation
		$('#get_location_button_area').css('display', 'inline-block')
	$('#search_city').focusin ->
		$('#search_postal_code').val('')
	$('#search_postal_code').focusin ->
		$('#search_city').val('')
	$('#get_location_button').click (e) ->
		e.preventDefault()
		$('#get_location_button_area').html('#{t "views.search_results.searching"}')
		if Modernizr.geolocation
			navigator.geolocation.getCurrentPosition(search_by_location)
	search_by_location = (position) ->
		search_path = '#{escape_javascript search_providers_path(query: @search_query, search_area_tag_id: @search_area_tag_id)} .expert_result'
		params = 'latitude='+position.coords.latitude+'&longitude='+position.coords.longitude
		$('.search_results_list').load(search_path, params, search_by_location_complete)
	search_by_location_complete = ->
		window.rating_score_reset() if window.rating_score_reset
		$('#get_location_button_area').html('#{t "views.search_results.showing_nearest_to_you"}')
