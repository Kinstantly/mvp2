.search_results
	%h1= search_results_title @search, @search_area_tag_id
	- if @search.results.present?
		.search_results_options
			= form_tag search_providers_path, method: :get, id: 'nearest_to_city_postal_code_form' do
				= hidden_field_tag :query, @search_query
				= hidden_field_tag :search_area_tag_id, @search_area_tag_id
				= t 'views.search_results.nearest_to_city_postal_code'
				- city_prompt = t 'views.search_results.city_prompt'
				= text_field_tag :city, @search_city, size: 12, id: 'search_city', placeholder: city_prompt, title: city_prompt
				= hidden_field_tag :region, DEFAULT_REGION
				= t 'views.or'
				- postal_code_prompt = t 'views.search_results.postal_code_prompt'
				= text_field_tag :postal_code, @search_postal_code, size: 10, id: 'search_postal_code', placeholder: postal_code_prompt, title: postal_code_prompt
				= submit_tag 'Show', disable_with: 'Show...', id: 'order_by_distance_button'
			#get_location_button_area{style: 'display: none'}
				= form_tag '#' do
					= t 'views.search_results.nearest_to_you'
					= submit_tag 'Nearest', id: 'get_location_button'
			- if @search_latitude && @search_longitude
				#nearest_results_msg= t 'views.search_results.nearest_results_msg', page: @search_page
	.search_results_list#content
		- @search.results.each_with_index do |profile, i|
			- profile_id = "profile_#{i}"
			%article.search_result.clearfix{itemscope: "", itemtype: "http://schema.org/Person", id: "search_result_#{i}"}
				.short-profile{id: profile_id}
					.popover
						.profile-photo-placeholder
						.profile
							%h1{itemprop: "name"}
								= profile.display_name_or_company
								- if profile.headline.present?
									%span.headline= profile.headline
							%span.specialties= search_result_specialties profile
							- location = profile.locations.order_by_id.first
							%span
								%span.location{itemprop: "street-address"}= location.try(:display_address)
								%span.location{itemprop: "telephone"}= location.try(:display_phone)
							%span
								%span.location{itemprop: "url"}= profile_display_website profile
								- if profile.email.present?
									%span.location{itemprop: "email"}
										= t 'views.profile.view.email'
										= profile_display_email profile
						.summary
							%span.text_area= profile_display_text profile.summary, preserve: true
				-# = image_tag 'profile-photo-placeholder.jpg', alt: "#{profile.display_name_or_company}", width: '168', height: '168', border: '0', class: 'profile-photo', itemprop: 'image'
				.profile-photo-placeholder
				.profile
					%h1.show_profile{itemprop: "name", 'data-profile-id' => profile_id}
						= profile_list_name_or_company_link profile, class: 'open'
						- if profile.headline.present?
							%span.headline= profile.headline
					%span.specialties= profile_display_truncated search_result_specialties(profile), length: 75
					%span.location{itemprop: "street-address"}= search_result_location profile
					%span.summary
						= profile_display_truncated profile.summary, length: 200, links: true
						= link_to t('views.search_results.more'), profile_path(profile), class: 'open'
				.rating-contact
					= render partial: 'profiles/rating_score', locals: {profile: profile}
					%ul.contact-toolbar
						%li.consult_by_email= profile_consult_by_email_element profile
						%li.consult_by_phone= profile_consult_by_phone_element profile
						%li.consult_by_video= profile_contact_icon_element :consult_by_video, profile
						%li.consult_in_person= profile_contact_icon_element :consult_in_person, profile
						%li.consult_in_group= profile_contact_icon_element :consult_in_group, profile
						%li.visit_home= profile_contact_icon_element :visit_home, profile
						%li.visit_school= profile_contact_icon_element :visit_school, profile
						%li.consult_at_hospital= profile_contact_icon_element :consult_at_hospital, profile
						%li.consult_at_camp= profile_contact_icon_element :consult_at_camp, profile
						%li.consult_at_other= profile_contact_icon_element :consult_at_other, profile
						%li.appointment
							%a{href: "#"} Make an appointment
		- if @search.results.present?
			.search_result= paginate @search.results

:coffeescript
	if Modernizr.geolocation
		$('#get_location_button_area').css('display', 'inline-block')
	$('#search_city').focusin ->
		$('#search_postal_code').val('')
	$('#search_postal_code').focusin ->
		$('#search_city').val('')
	$('#get_location_button').click (e) ->
		e.preventDefault()
		$('#get_location_button_area').html('#{t "views.search_results.searching"}')
		if Modernizr.geolocation
			navigator.geolocation.getCurrentPosition(search_by_location)
	search_by_location = (position) ->
		search_path = '#{escape_javascript search_providers_path(query: @search_query, search_area_tag_id: @search_area_tag_id)} .search_result'
		params = 'latitude='+position.coords.latitude+'&longitude='+position.coords.longitude
		$('.search_results_list').load(search_path, params, search_by_location_complete)
	search_by_location_complete = ->
		window.rating_score_reset() if window.rating_score_reset
		$('#get_location_button_area').html('#{t "views.search_results.showing_nearest_to_you"}')
		$('#nearest_results_msg').remove()
		window.link_short_profiles()
	# Pop-up short profiles
	window.link_short_profiles = ->
		$('.show_profile').mouseenter ->
			id = $(this).attr('data-profile-id')
			top = $(this).height() + 8
			$('#'+id).css('top', top).addClass 'active'
			false
		$('.show_profile').mouseleave ->
			id = $(this).attr('data-profile-id')
			$('#'+id).removeClass 'active'
			false
	window.link_short_profiles()
