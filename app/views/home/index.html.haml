- @body_class = 'home'
- content_for :head_before_js do
	= stylesheet_link_tag 'home_page', media: 'screen, handheld, print'
	/[if lt IE 9]
		= stylesheet_link_tag 'home_page_ie8', media: 'screen, handheld, print'
#container.clearfix
	%header#branding.clearfix
		%nav#access.clearfix
			%ul
				%li#skip
					%a{href: '#content'}= t 'views.accessibility'
				%li#about= about_link
				%li#contact= contact_link
				- if user_signed_in?
					- if current_user.is_provider?
						%li#myprofile= view_my_profile_link
					%li#settings= account_settings_link
					%li#signout= sign_in_out_link
				- else
					%li#signin
						= t 'views.sign_in.prompt'
						= sign_in_out_link
		%h1= home_link_with_tagline
		-# #msg= t 'views.home.view.marketing_message_default'
	#search_providers.aside
		= form_tag search_providers_path, method: :get, id: 'providerSearch' do
			%h2= t 'views.home.view.search_title'
			= text_field_tag :query, default_search_query(@search_query, @search_service), id: 'provider_search_query', autocomplete: 'off', placeholder: t('views.search.query_placeholder')
			= text_field_tag :address, @search_address, id: 'provider_search_location', placeholder: t('views.search.address_placeholder')
			= submit_tag 'Search for free', disable_with: 'Searching...', class: 'button submit green', id: 'provider_search_button'
			- if !user_signed_in?
				%p.small
					= t 'views.sign_up.provider_prompt'
					= provider_sign_up_link t('views.sign_up.provider_link')
	- cache CategoryList.home_list do
		#content.category-list.clearfix
			%h2= t 'views.home.view.browse_title'
			-# %span.help= t 'views.home.view.tutorial_link_html'
			- (1..2).each do |column|
				.col{id: "col#{column}"}
					- home_column_categories(column).each do |category|
						%h3= category.name
						- category.subcategories.by_display_order.order_by_name.each do |subcategory|
							%h4= subcategory.name
							%ul
								- visible_service_count = 8
								- subcategory.services.by_display_order.order_by_name.each_with_index do |service, i|
									- li_class = i >= visible_service_count ? 'extra_service' : 'visible_service'
									%li{class: li_class}
										= link_to service.name, search_providers_by_service_path(service)
								- if subcategory.services.size > visible_service_count
									%li
										= link_to t('views.home.view.more_services'), '#', class: 'toggle_extra_services more_services'
										= link_to t('views.home.view.fewer_services'), '#', class: 'toggle_extra_services fewer_services'
					- if column == 2
						#all-cats.see-all
							= link_to t('views.home.view.see_all_services'), '#', id: 'see_all_services'
							= link_to t('views.home.view.see_fewer_services'), '#', id: 'see_fewer_services'
			-#
				#all-cats.see-all.select-wrapper
					%span.select-text
					%select
						%option{:selected => "selected"} See all
						%option This is a dropdown
						%option of all categories?
		#social
			= link_to t('contact.social.twitter.display'), t('contact.social.twitter.value'), target: '_blank', id: 'twitter'
			= link_to t('contact.social.facebook.display'), t('contact.social.facebook.value'), target: '_blank', id: 'facebook'

:coffeescript
	$('li a.toggle_extra_services').on 'click', (e) ->
		$('li.extra_service', $(this).parent().parent()).toggle(200)
		$('a', $(this).parent()).toggle()
		false
		
	$('#see_all_services').on 'click', (e) ->
		$('li.extra_service').show(200)
		$('a.more_services, #see_all_services').hide()
		$('a.fewer_services, #see_fewer_services').show()
		false
		
	$('#see_fewer_services').on 'click', (e) ->
		$('li.extra_service').hide(200)
		$('a.fewer_services, #see_fewer_services').hide()
		$('a.more_services, #see_all_services').show()
		false
